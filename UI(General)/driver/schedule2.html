<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <!-- JQuery  -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <!-- Stripe -->
        <script src="https://js.stripe.com/v3/"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

        <title>View Deliveries</title>

        <!-- External CSS styling -->
    <link rel="stylesheet" href="../css/schedule.css">

    <!--Import Rubik font-->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rubik&display=swap');
    </style>

    <!--Import Roboto font-->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');
    </style>

    <!--Import Patua One font-->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Patua+One&display=swap');
    </style>

</head>
<body>
    <header> 
        <img class="logo" src="../images/logo.jpg" width='80px;' height='40px;' alt="logo">
        <nav>
            <ul class="nav__links">
                <li><a href="../driver/driver_home.html">Home</a></li>
                <li><a href="../driver/schedule.html">View Schedule</a></li>
                <li><a href="driver_profile.html">Profile</a></li>
            </ul>
        </nav>
        <a class="LogOut" href="../landing.html"><button class='btn'>Log Out</button></a>
    </header>


    <div id='app' @load='getSchedule()'>
        <div class='container'>
            <div class='row'>
                <div class='col'></div>
                <div class='col'><h1 class='pt-3' style='color:#CEA68C; font-family: "Patua One", cursive;'>Schedule</h1></div>
                <div class='col'></div>
            </div>
            <!-- <div class='row' v-if='!hasDeliveries'>
    
                <div id="loader"></div>
                
                
            </div> -->
            
            <!-- <div class="container-fluid">
                <div class="row">
                    <div class='col mx-auto'></div>
                    <div class='col d-flex justify-content-center smx-auto loader'></div>
                    <div class='col mx-auto'></div>
                </div>
            </div> -->
            <div class='container'>
                <div class='row mt-2'>
                    <div class='col-2' style='color:#CEA68C; font-family: "Patua One", cursive; font-size: 25px;'>Filter by:</div>
                    <div class='col'>
                        <div class="form-group">
                            <!-- <label for="time">Schedule</label> -->
                            <select @change = "checkSchedule" id="time" class="form-control">
                                <option selected value='filterAll'>Show All</option>
                                <option value='filterDay'>Filter by day</option>
                                <!-- <option value='12_to_2'>12pm to 2pm</option>
                                <option value="2_to_4">2pm to 4pm</option>
                                <option value='4_to_6'>4pm to 6pm</option> -->
                            </select>
                        </div> 
                    </div>
                    
                </div>
            </div>
            <table v-if='hasDeliveries' class = "table table-striped animate__animated animate__backInUp">
                <!-- <div class='col-md-8 my-3' style='background-color:#FFFAF0;'>
                    hello
                </div>
                <div class='col-md-4 my-3'>
                    hello
                </div> -->
                <thead>
                    <tr>
                        <th>Delivery ID</th>
                        <th>Delivery Item</th>
                        <th>Delivery Description</th>
                        <th>Delivery Status</th>
                        <th>Delivery Date</th>
                        <th>Pickup Location</th>
                        <th>Destination</th>
                        <th>Driver Mobile Number</th>
                        <th>Payment Status</th>
                    </tr>
                    <tr v-for="delivery in deliveries">
                            <td>{{delivery.delivery_ID}}</td>
                            <td>{{delivery.delivery_item}}</td>
                            <td>{{delivery.description}}</td>
                            <td>{{delivery.delivery_status}}</td>
                            <td>{{delivery.delivery_date.slice(0,-12)}}</td>
                            <td>{{delivery.pickup_location}}</td>
                            <td>{{delivery.destination}}</td>
                            <td>{{delivery.driver_mobile}}</td>
                            <td>{{delivery.payment_status}}</td>

                    </tr>
                </thead>
            </table>
        </div>
    </div>

    <script>
        var session = JSON.parse(sessionStorage.getItem("account_details"));
        var customer_ID = session.customer_ID;
        var get_details_url = "http://localhost:5004/schedule/driver/" + customer_ID;
        var app = new Vue({
            el: "#app",
            data:{
                hasDeliveries: false,
                deliveries: []
            },
            mounted: function(){
                this.getDeliveries()
            },
            methods:{
                getDeliveries: function(){
                    const response =
                    fetch(get_details_url)
                        .then(response => response.json())
                        .then(data => {
                            console.log(response);
                            console.log(data);
                            // if (data.code === 404) {
                            //     // no book in db
                            //     this.message = data.message;
                            // } else {
                            //     this.books = data.data.books;
                            // }
                            if (data.data.customer_view_details.length>0){
                                this.hasDeliveries = true
                                
                                this.deliveries = data.data.customer_view_details
                            }
                        })
                        .catch(error => {
                            // Errors when calling the service; such as network error, 
                            // service offline, etc
                            console.log(this.message + error);

                        });
                }
            }
        })

    var myVar;
    
    function myFunction() {
        myVar = setTimeout(showPage, 3000);
    }
        
    function showPage() {
        document.getElementById("loader").style.display = "none";
        document.getElementById("myDiv").style.display = "block";
    }
    </script>
</body>
</html>